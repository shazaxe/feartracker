<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fear Tracker</title>
    <script src="https://unpkg.com/@owlbear-rodeo/sdk/lib/index.umd.js"></script>
    <style>
        body {
            margin: 0;
            padding: 15px;
            background: linear-gradient(135deg, #0d0d0d, #1a0000);
            font-family: 'Arial', sans-serif;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            overflow: hidden;
            width: 350px;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, transparent 0%, rgba(0, 0, 0, 0.8) 100%);
            pointer-events: none;
            z-index: -1;
        }

        .fear-tracker {
            text-align: center;
            padding: 15px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 15px;
            border: 2px solid #333;
            box-shadow: 0 0 50px rgba(255, 0, 0, 0.3), inset 0 0 50px rgba(0, 0, 0, 0.8);
            width: 100%;
        }

        .title {
            font-size: 1.8em;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .skull-clock {
            position: relative;
            width: 250px;
            height: 250px;
            margin: 20px auto;
            border-radius: 50%;
            border: 2px solid #666;
            background: radial-gradient(circle, rgba(20, 20, 20, 0.8), rgba(10, 10, 10, 0.9));
            animation: ominousPulse 3s infinite ease-in-out;
        }

        .skull {
            position: absolute;
            width: 25px;
            height: 25px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            cursor: default;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        }

        .skull.lit {
            color: #ff0000;
            filter: drop-shadow(0 0 20px #ff0000) drop-shadow(0 0 40px #ff0000) drop-shadow(0 0 60px #ff0000);
            transform: scale(1.3);
            animation: menacingGlow 2s infinite alternate;
        }

        .skull.dark {
            color: #111;
            filter: none;
            transform: scale(1);
            text-shadow: 0 0 2px #000;
        }

        .controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }

        .counter-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 50%;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        .counter-btn.up {
            background: linear-gradient(135deg, #ff6b6b, #ff4757);
            box-shadow: 0 4px 15px rgba(255, 71, 87, 0.3);
        }

        .counter-btn.down {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
        }

        .counter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.2);
        }

        .counter-btn:active {
            transform: translateY(0);
        }

        .fear-count {
            font-size: 2.2em;
            font-weight: bold;
            color: #ff4757;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            min-width: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reset-btn {
            background: linear-gradient(135deg, #2d3436, #636e72);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.2s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .reset-btn:hover {
            background: linear-gradient(135deg, #636e72, #2d3436);
            transform: translateY(-1px);
        }

        /* Animation for fear changes */
        @keyframes fearGain {
            0% { transform: scale(1); }
            50% { transform: scale(1.5); filter: drop-shadow(0 0 30px #ff0000) drop-shadow(0 0 60px #ff0000); }
            100% { transform: scale(1.3); }
        }

        @keyframes fearLoss {
            0% { transform: scale(1.3); }
            50% { transform: scale(0.7); filter: drop-shadow(0 0 5px #ff0000); }
            100% { transform: scale(1); }
        }

        @keyframes menacingGlow {
            0% { 
                filter: drop-shadow(0 0 15px #ff0000) drop-shadow(0 0 30px #ff0000) drop-shadow(0 0 45px #ff0000);
                text-shadow: 0 0 10px #ff0000, 0 0 20px #ff0000, 0 0 30px #ff0000;
            }
            100% { 
                filter: drop-shadow(0 0 25px #ff0000) drop-shadow(0 0 50px #ff0000) drop-shadow(0 0 75px #ff0000);
                text-shadow: 0 0 15px #ff0000, 0 0 30px #ff0000, 0 0 45px #ff0000;
            }
        }

        @keyframes ominousPulse {
            0% { 
                box-shadow: 0 0 30px rgba(255, 0, 0, 0.3), inset 0 0 30px rgba(255, 0, 0, 0.1);
            }
            50% {
                box-shadow: 0 0 50px rgba(255, 0, 0, 0.6), inset 0 0 50px rgba(255, 0, 0, 0.2);
            }
            100% { 
                box-shadow: 0 0 30px rgba(255, 0, 0, 0.3), inset 0 0 30px rgba(255, 0, 0, 0.1);
            }
        }

        .skull.gaining {
            animation: fearGain 0.5s ease;
        }

        .skull.losing {
            animation: fearLoss 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="fear-tracker">
        <div class="title">FEAR TRACKER</div>
        
        <div class="skull-clock" id="skullClock">
            <!-- Skulls will be generated by JavaScript -->
        </div>

        <div class="controls">
            <button class="counter-btn down" onclick="decreaseFear()" title="Spend Fear">âˆ’</button>
            <div class="fear-count" id="fearCount">0</div>
            <button class="counter-btn up" onclick="increaseFear()" title="Gain Fear">+</button>
        </div>

        <button class="reset-btn" onclick="resetFear()">Reset Fear</button>
    </div>

    <script>
        let fearLevel = 0;
        let isReady = false;
        const maxFear = 12;
        const FEAR_METADATA_ID = "fear-tracker-data";

        // Initialize OBR connection
        OBR.onReady(() => {
            isReady = true;
            loadFearFromMetadata();
            console.log("Fear Tracker extension loaded!");
        });

        // Create skulls arranged in a circle
        function createSkullClock() {
            const clock = document.getElementById('skullClock');
            const radius = 100; // Distance from center (smaller for popover)
            
            for (let i = 0; i < maxFear; i++) {
                const skull = document.createElement('div');
                skull.className = 'skull dark';
                skull.innerHTML = 'ðŸ’€';
                skull.id = `skull-${i}`;
                
                // Calculate position (starting from top, going clockwise)
                const angle = (i * 30) - 90; // 30 degrees per skull, start at top
                const radians = (angle * Math.PI) / 180;
                const x = radius * Math.cos(radians);
                const y = radius * Math.sin(radians);
                
                skull.style.left = `calc(50% + ${x}px - 12.5px)`;
                skull.style.top = `calc(50% + ${y}px - 12.5px)`;
                
                clock.appendChild(skull);
            }
        }

        // Update skull display based on fear level
        function updateSkulls() {
            for (let i = 0; i < maxFear; i++) {
                const skull = document.getElementById(`skull-${i}`);
                if (i < fearLevel) {
                    skull.className = 'skull lit';
                } else {
                    skull.className = 'skull dark';
                }
            }
        }

        // Save fear level to OBR scene metadata
        async function saveFearToMetadata() {
            if (!isReady) return;
            
            try {
                await OBR.scene.setMetadata({
                    [FEAR_METADATA_ID]: {
                        fearLevel: fearLevel,
                        lastUpdated: Date.now()
                    }
                });
            } catch (error) {
                console.error("Failed to save fear data:", error);
            }
        }

        // Load fear level from OBR scene metadata
        async function loadFearFromMetadata() {
            if (!isReady) return;
            
            try {
                const metadata = await OBR.scene.getMetadata();
                const fearData = metadata[FEAR_METADATA_ID];
                
                if (fearData && typeof fearData.fearLevel === 'number') {
                    fearLevel = Math.max(0, Math.min(maxFear, fearData.fearLevel));
                    document.getElementById('fearCount').textContent = fearLevel;
                    updateSkulls();
                }
            } catch (error) {
                console.error("Failed to load fear data:", error);
            }
        }

        // Increase fear level
        function increaseFear() {
            if (fearLevel < maxFear) {
                fearLevel++;
                document.getElementById('fearCount').textContent = fearLevel;
                updateSkulls();
                
                // Add animation to the newly lit skull
                const newSkull = document.getElementById(`skull-${fearLevel - 1}`);
                if (newSkull) {
                    newSkull.classList.add('gaining');
                    setTimeout(() => newSkull.classList.remove('gaining'), 500);
                }
                
                saveFearToMetadata();
            }
        }

        // Decrease fear level
        function decreaseFear() {
            if (fearLevel > 0) {
                // Add animation to the skull being extinguished
                const oldSkull = document.getElementById(`skull-${fearLevel - 1}`);
                if (oldSkull) {
                    oldSkull.classList.add('losing');
                    setTimeout(() => oldSkull.classList.remove('losing'), 500);
                }
                
                fearLevel--;
                document.getElementById('fearCount').textContent = fearLevel;
                updateSkulls();
                saveFearToMetadata();
            }
        }

        // Reset fear to 0
        function resetFear() {
            fearLevel = 0;
            document.getElementById('fearCount').textContent = fearLevel;
            updateSkulls();
            saveFearToMetadata();
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'ArrowUp' || event.key === '+' || event.key === '=') {
                event.preventDefault();
                increaseFear();
            } else if (event.key === 'ArrowDown' || event.key === '-') {
                event.preventDefault();
                decreaseFear();
            } else if (event.key === 'r' || event.key === 'R') {
                event.preventDefault();
                resetFear();
            }
        });

        // Initialize the extension
        document.addEventListener('DOMContentLoaded', function() {
            createSkullClock();
        });
    </script>
</body>
</html>
